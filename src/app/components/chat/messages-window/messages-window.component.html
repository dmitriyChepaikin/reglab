<nav class="flex justify-between items-center gap-6 pb-2 pt-1 border-underline">
  <div class="flex gap-4 items-center">
    <div class="relative">
      <p-avatar
        shape="circle"
        [icon]="'pi ' + (isChannelType(selectedUserOrChannel) ? 'pi-star' : 'pi-user')"
        styleClass="mr-2"
        size="large"
      ></p-avatar>
      @if (!isChannelType(selectedUserOrChannel) && !!selectedUserOrChannel?.is_online) {
        <div class="rounded-full bg-teal-600 absolute bottom-0 right-2.5 w-3 h-3">
        </div>
      }
    </div>
    <span class="text-theme-black text-xl font-bold">
    {{
        (isChannelType(selectedUserOrChannel)
          ? selectedUserOrChannel?.name
          : selectedUserOrChannel?.username) ?? ''
      }}
    </span>
  </div>
  <div class="flex gap-2">
    <p-button
      (click)="op.toggle($event)"
      styleClass="shadow-none font-semibold text-theme-main-accent"
      [text]="true"
      icon="pi pi-ellipsis-v text-xl"
    >
    </p-button>

    <p-overlayPanel #op styleClass="no-arrow">
      <div class="flex max-w-[300px] flex-col justify-center gap-3 text-center">
        <div class="flex gap-4 items-center">
          <div class="relative">
            <p-avatar
              shape="circle"
              [icon]="'pi ' + (isChannelType(selectedUserOrChannel) ? 'pi-star' : 'pi-user')"
              styleClass="mr-2"
              size="xlarge"
            ></p-avatar>
            @if (!isChannelType(selectedUserOrChannel) && !!selectedUserOrChannel?.is_online) {
              <div class="rounded-full bg-teal-600 absolute bottom-1 right-3 w-3 h-3">
              </div>
            }
          </div>
          <div class="flex flex-col gap-1 text-start">
            <div class="font-semibold">
              {{ (isChannelType(selectedUserOrChannel) ? selectedUserOrChannel?.name : selectedUserOrChannel?.username) ?? '' }}
            </div>
          </div>
        </div>
        <p-button
          class="mt-3"
          styleClass="w-full teal-btn"
          label="Ðnything"
        ></p-button>
      </div>
    </p-overlayPanel>
  </div>
</nav>
<div class="w-full h-full flex flex-col justify-between gap-6 overflow-hidden rounded-lg bg-theme-main-accent-5">
  <div
    class="flex flex-col h-max w-full flex-1 gap-4 overflow-auto p-4"
    #messagesScroll
  >
    @for (message of messages; track message.id) {
      @if (message.from_user === currentUserId) {
        <!-- Owner message type -->
        <div class="ml-auto mt-4 w-max max-w-[400px] self-end">
          <div class="text-theme-main-accent-200 text-sm font-semibold">You</div>
          <div class="relative rounded-md rounded-tr-none bg-theme-main-accent py-2 pl-4 pr-8">
              <span class="text-wrap font-semibold text-white custom-text-wrap">
                {{ message.content }}
              </span>
          </div>
        </div>
      }
      @if (message.from_user !== currentUserId) {
        <!-- Companion -->
        <div class="mt-4 w-max max-w-[45%] self-start flex flex-col gap-1">
          <div class="text-theme-main-accent-200 text-sm font-semibold">
            {{ (message.username || userChatName) ?? 'Unknown' }}
          </div>
          <div class="rounded-md rounded-tl-none bg-[#616161] px-4 py-2">
              <span class="font-semibold text-white custom-text-wrap">
                {{ message.content }}
              </span>
          </div>
        </div>
      }
    }
  </div>
  <!-- Chat form -->
  <div class="flex gap-4 p-4 pt-0">
          <textarea
            #messageTextRef
            class="max-h-[120px] min-h-[45px] w-full"
            placeholder="Enter a message"
            rows="1"
            [(ngModel)]="messageText"
            cols="30"
            (keydown)="handleTextareaKeyDown($event)"
            pInputTextarea
            (keyup.enter)="sendMessage()"
            [autoResize]="true">
          </textarea>
    <p-button (onClick)="sendMessage()" styleClass="h-full">
      <span class="pi pi-send"></span>
    </p-button>
  </div>
</div>


